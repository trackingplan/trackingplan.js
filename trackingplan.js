(function(){function a(a){var b={method:"POST",endpoint:"TRACKINGPLAN",payload:JSON.stringify(a)};p(b)}function b(a){if(da.includes("img"))try{i(a)}catch(a){I(a)}if(da.includes("xhr"))try{k(a)}catch(a){I(a)}if(da.includes("beacon"))try{l(a)}catch(a){I(a)}if(da.includes("form"))try{o(a)}catch(a){I(a)}if(da.includes("ws"))try{n(a)}catch(a){I(a)}if(da.includes("fetch"))try{m(a)}catch(a){I(a)}}function c(){var a=d();if(null!==a&&!ba)return!1;var b={landing:document.location.href,referrer:document.referrer};return L.setItem("_trackingplan_initial",JSON.stringify(b)),!0}function d(){return JSON.parse(L.getItem("_trackingplan_initial"))}function e(){try{if(L.setItem("_tp_t","a"),"a"!==L.getItem("_tp_t"))return!1;if(L.removeItem("_tp_t"),"function"!=typeof navigator.sendBeacon)return!1}catch(a){return!1}return!0}function f(a){return"string"==typeof a||a instanceof String}function g(a,b){if(0===b.length)return!0;for(var c=0;c<b.length;c++){if(O.call(a,"payload")&&"string"==typeof a.payload&&0<=a.payload.indexOf(b[c]))return!0;if(O.call(a,"endpoint")&&"string"==typeof a.endpoint&&0<=a.endpoint.indexOf(b[c]))return!0}return!1}function h(a){return!(null!==la)||0<=la.indexOf(a)}function i(a){var b=a.Object.getOwnPropertyDescriptor(a.HTMLImageElement.prototype,"src").set;a.Object.defineProperty(a.HTMLImageElement.prototype,"src",{set:function(a){return!f(a)||2048<a.length?b.apply(this,arguments):(p({method:"GET",endpoint:a,protocol:"img"}),b.apply(this,arguments))}});var c=a.HTMLImageElement.prototype.setAttribute;a.HTMLImageElement.prototype.setAttribute=function(a,b){if("src"==a.toLowerCase()){if(!f(b)||b.length>2048)return c.apply(this,arguments);p({method:"GET",endpoint:b,protocol:"img"})}return c.apply(this,arguments)}}function j(a){var b=a;try{b instanceof FormData&&(b=JSON.stringify(Object.fromEntries(b)))}catch(a){}return b}function k(a){var b=a.XMLHttpRequest.prototype.open,c=a.XMLHttpRequest.prototype.send;a.XMLHttpRequest.prototype.open=function(a,c){return this._tpUrl=c,this._tpMethod=a,b.apply(this,arguments)},a.XMLHttpRequest.prototype.send=function(a){var b=j(a);return p({method:this._tpMethod,endpoint:this._tpUrl,payload:b,protocol:"xhr"}),c.apply(this,arguments)}}function l(a){var b=a.navigator.sendBeacon;a.navigator.sendBeacon=function(a,c){if(!f(a)||2048<a.length)return b.apply(this,arguments);var d=j(c);return p({method:"POST",endpoint:a,payload:d,protocol:"beacon"}),b.apply(this,arguments)}}function m(a){var b=a.fetch;a.fetch=function(a,c){if(!f(a)||2048<a.length)return b.apply(this,arguments);var d="GET",e=null;return void 0!==c&&(void 0!==c.method&&(d=c.method.toUpperCase()),void 0!==c.body&&(e=j(c.body))),p({method:d,endpoint:a,payload:e,protocol:"fetch"}),b.apply(this,arguments)}}function n(a){var c=a.WebSocket;a.WebSocket=function(d,a){return a?new c(d,a):new c(d)};var b=c.prototype.send;c.prototype.send=function(a){return p({method:"WS",endpoint:this.url,payload:a,protocol:"ws"}),b.apply(this,arguments)},a.WebSocket.prototype=c.prototype}function o(a){a.addEventListener("submit",function(a){try{var b=a?a.target:this,c={method:b.method,endpoint:b.action,payload:JSON.stringify({location:M.location.href,form_id:b.id,method:b.method,form_data:Object.fromEntries(new FormData(b))}),protocol:"form"};p(c)}catch(a){}},!0)}function p(a,b){setTimeout(function(){try{var c=G(a);if("TRACKINGPLAN"==a.endpoint&&(c="trackingplan"),!c)return;if(!h(c))return void I({m:"Request ignored ("+c+" not in whitelist)",request:a});if(!g(a,ka))return void I({m:"Request ignored (content filter)",request:a});var d=E();return!1===d?(oa.push(a),I({m:"Pre queued, queue length = "+oa.length}),setTimeout(C,Y),!1):(null===ra&&(ra=y(),sa=JSON.stringify(ra).length),!v($,d))?(I({m:"Request ignored (sampling)",mode:$,dict:d}),!0):(q(w(a,c)),"function"==typeof b&&b(),!0)}catch(b){J({m:"Trackingplan process error",error:b,request:a})}},0)}function q(a){fa(a);var b=JSON.stringify(a);if(2e5<b.length&&I({m:"Track Too big, ignored: "+b.length}),b.length+2+sa>_)return s(a,U),void I({m:"Track > Batch Size: "+b.length});var c=pa.length+b.length+sa;c>_&&(I({m:"Batch reaching limit: "+c}),r(U)),c=pa.length+b.length+sa,I({m:"Queue len: "+c,rawTrack:a}),0!==pa.length&&(pa+=","),pa+=b}function r(a){if(0!=pa.length){var b=pa;pa="";var c={requests:JSON.parse("["+b+"]"),common:ra};u(c,a)}}function s(a,b){var c={requests:[a],common:ra};u(c,b)}function t(){var a=W+R;return ha&&(a+="?debug=true"),a}function u(a,b){return("function"==typeof ga&&(a=ga(a)),I({m:"Sent",payload:a}),ca)?void I("Not sending, is dry run"):void("xhr"===b?function(a){var b=new XMLHttpRequest;b.open("POST",t(),!0),b.onreadystatechange=function(){if(4===b.readyState)try{I({m:"Parsed",response:JSON.parse(b.response)}),ea(a,b.response)}catch(a){}},b.send(a)}(JSON.stringify(a)):"beacon"===b?function(a){navigator.sendBeacon(t(),a)}(JSON.stringify(a)):void 0)}function v(a,b){switch(a){case"user":return 1===b.isSampledUser;case"track":return Math.random()<1/b.sampleRate;case"all":return!0;case"none":default:return!1;}}function w(a,b){return{provider:b,request:{endpoint:a.endpoint,method:a.method,post_payload:a.payload||null,protocol:a.protocol,href:M.location.href},ts:new Date().getTime()}}function x(){return H({hostname:M.location.hostname,user_agent:navigator.userAgent,load_url:qa},d())}function y(){return{context:x(),tp_id:R,source_alias:T,environment:S,sdk:ta.sdk,sdk_version:ta.sdkVersion,sampling_rate:E().sampleRate,debug:V,tags:ia}}function z(){try{for(var a=window.performance.getEntriesByType("resource"),b={},c=[],d=0;d<a.length;d++){c.push(a[d].name);var e="",f=a[d].name.replace(/(^\w+:|^)\/\//,""),g=f.split("?"),h=g[0];g=h.split("/"),e=1<g.length?g[0]+"/"+g[1]:g[0];var j=e;O.call(b,j)||(b[j]=0),b[j]++}return b}catch(a){return null}}function A(){for(;oa.length;){var a=oa.shift();p(a)}}function B(a,b){return O.call(a,"environment_rates")&&O.call(a.environment_rates,b)?a.environment_rates[b]:a.sample_rate}function C(){if(!na){var b=new XMLHttpRequest,c=X+"config-"+R+".json";b.onreadystatechange=function(){if(4==this.readyState)try{D(B(JSON.parse(this.responseText),S)),a({event_name:"new_dau"}),A()}catch(a){}na=!1},b.open("GET",c,!0),na=!0,b.send()}}function D(a){if(!1===a)return L.removeItem("_trackingplan_sample_rate"),L.removeItem("_trackingplan_sample_rate_ts"),void L.removeItem("_trackingplan_is_sampled_user");var b=Math.random()<1/a?1:0;I({m:"Trackingplan sample rate = "+a+". isSampledUser "+b}),L.setItem("_trackingplan_sample_rate_ts",new Date().getTime()),L.setItem("_trackingplan_sample_rate",a),L.setItem("_trackingplan_is_sampled_user",b)}function E(){var a=L.getItem("_trackingplan_sample_rate_ts");return null!==a&&(parseInt(a)+1e3*Z<new Date().getTime()?(I({m:"Trackingplan sample rate expired"}),D(!1),!1):{sampleRate:parseInt(L.getItem("_trackingplan_sample_rate")),isSampledUser:parseInt(L.getItem("_trackingplan_is_sampled_user"))})}function F(a,b){if(null===a||null===b)return!0;if("/"===a[0]){var c=new RegExp(a.slice(1,-1));return c.test(b)}return-1!==b.indexOf(a)}function G(a){var b=a.endpoint,c=a.payload;if(f(b)){for(var d in Q){var e=d.split("%"),g=e[0],h=2===e.length?e[1]:null;if(F(g,b)&&F(h,c))return Q[d]}return!1}}function H(b,c){for(var d in c)b[d]=c[d];return b}function I(a){V&&N.log("TP "+R,a)}function J(a){M.console&&N.warn&&N.warn(a)}function K(){function a(){for(var a=document.getElementsByTagName("IFRAME"),b=0;b<a.length;b++)d(a[b])}function c(a){try{return!!a.contentDocument}catch(a){return!1}}function d(a){try{c(a)&&(b(a.contentWindow),I("Intercepted frame "+a.id))}catch(a){}}function e(){var a=new MutationObserver(function(a){a.forEach(function(a){a.addedNodes.forEach(function(a){"IFRAME"==a.tagName&&d(a)})})});a.observe(document,{subtree:!0,childList:!0,attributes:!1,characterData:!1}),setTimeout(a.disconnect(),4e3)}"complete"===document.readyState?(a(),e()):document.onreadystatechange=function(){"complete"===document.readyState&&(a(),e())}}var L=localStorage,M=window,N=console,O=Object.prototype.hasOwnProperty;if(M.Trackingplan)return void J("Trackingplan snippet included twice.");var P={"google-analytics.com":"googleanalytics","analytics.google.com":"googleanalytics","api.segment.io":"segment",segmentapi:"segment","seg-api":"segment","segment-api":"segment","/.*api-iam.intercom.io/messenger/web/(ping|events|metrics|open).*/":"intercom","api.amplitude.com":"amplitude","ping.chartbeat.net":"chartbeat","/.*api(-eu)?(-js)?.mixpanel.com.*/":"mixpanel","trk.kissmetrics.io":"kissmetrics","ct.pinterest.com":"pinterest","facebook.com/tr/":"facebook","track.hubspot.com/__":"hubspot","/.*.heapanalytics.com/(h|api).*/":"heap","/.*snowplow.*/":"snowplow","/.*ws.*.hotjar.com/api/v2/client/ws/%identify_user":"hotjar","/.*ws.*.hotjar.com/api/v2/client/ws/%tag_recording":"hotjar","klaviyo.com/api/track":"klaviyo","app.pendo.io/data":"pendo","matomo.php":"matomo","rs.fullstory.com/rec%8137":"fullstory","rs.fullstory.com/rec%8193":"fullstory","logx.optimizely.com/v1/events":"optimizely","track.customer.io/events/":"customerio","alb.reddit.com/rp.gif":"reddit","px.ads.linkedin.com":"linkedin","/i/adsct":"twitter","bat.bing.com":"bing","pdst.fm":"podsights","analytics.tiktok.com/api/v2":"tiktok"},Q={},R=null,S="PRODUCTION",T=null,U="xhr",V=!1,W="https://tracks.trackingplan.com/v1/",X="https://config.trackingplan.com/",Y=0,Z=86400,$="user",_=6e4,aa=20,ba=!1,ca=!1,da=["img","xhr","beacon","fetch"],ea=function(){},fa=function(){},ga=function(a){return a},ha=!1,ia={},ja=null,ka=[],la=null,ma=!1,na=!1,oa=[],pa="",qa="",ra=null,sa=0,ta=M.Trackingplan={sdk:"js",sdkVersion:"1.14.3",options:null,tpId:null,setOptions:function(a,b){b=this.options=b||{},R=this.tpId=a,S=b.environment||S,T=b.sourceAlias||T,U=b.sendMethod||U,Q=H(P,b.customDomains||{}),V=b.debug||V,W=b.tracksEndPoint||W,X=b.configEndPoint||X,Y=b.delayConfigDownload||Y,Z=b.sampleRateTTL||Z,$=b.samplingMode||$,_=b.batchSize||_,aa=b.batchInterval||aa,ba=b.alwaysSendNewUser||ba,ca=b.dryRun||ca,da=b.intercept||da,ea=b.onSubmit||ea,ha=b.parse||ha,fa=b.onQueue||fa,ga=b.onBeforeSubmit||ga,ia=b.tags||ia,ja=b.samplingRate||ja,ka=b.contentFilters||ka,la=b.providersWhitelist||la,ma=b.realtime||ma,ma&&(ja=1,$="all",_=1),I({m:"TP options updated",options:b})},init:function(d,f){try{if(!e())throw new Error("TP Not compatible browser");if(null!==R)throw new Error("TP Init already happened");ta.setOptions(d,f),null!==ja&&D(ja),qa=M.location.href,b(window),da.includes("frame")&&K(),document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&r("beacon")}),M.addEventListener("pagehide",function(){r("beacon")}),c()&&a({event_name:"new_user"}),a({event_name:"page_load"}),setTimeout(function(){a({event_name:"pixels",properties:{pixels:z()}})},1e4),setInterval(function(){r(U)},1e3*aa),I({m:"TP init finished",options:f})}catch(a){J({m:"TP init error",error:a})}}}})();